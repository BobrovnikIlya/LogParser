<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä Proxy –õ–æ–≥–æ–≤</title>
    <link rel="stylesheet" href="style.css?v=1.2">
    <link rel="stylesheet" href="modal.css?v=1.2">
    <link rel="stylesheet" href="stats.css?v=1.2">
</head>
<body>
    <div class="notification" id="notification"></div>
    
    <div class="container">
        <header>
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–ª–µ–≤–∞ (~30% —à–∏—Ä–∏–Ω—ã) -->
            <div class="header-title">
                <h1>üìä –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä Proxy –õ–æ–≥–æ–≤</h1>
                <p>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ proxy-—Å–µ—Ä–≤–µ—Ä</p>
                <!-- –ö–Ω–æ–ø–∫–∞ –¢–µ–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—é–¥–∞ -->
                <div class="header-theme-button">
                    <button onclick="toggleTheme()" class="btn-secondary">–¢–µ–º–∞</button>
                </div>
            </div>
            
            <!-- –£–ø—Ä–∞–≤–ª—è—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø—Ä–∞–≤–∞ (~70% —à–∏—Ä–∏–Ω—ã) -->
            <div class="header-controls">
                <!-- –ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Å–∏–Ω–≥–æ–º -->
                <div class="parsing-controls">
                    <div class="parsing-header">
                        <h3>üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–æ–º –ª–æ–≥–æ–≤</h3>
                    </div>
                    <div class="parsing-content">
                    <div class="parsing-info">
                            <div id="parsingStatus">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</div>
                            <div id="parsingDetails" class="parsing-details" style="display: none;"></div>
                            <div id="parsingStage" class="parsing-stage" style="display: none;"></div>
                            <div id="parsingProgress" class="progress-container">
                                <div class="progress-bar">
                                    <div id="parsingProgressBar" class="progress-fill" style="width: 0%"></div>
                                </div>
                                <div id="parsingProgressText" class="progress-info">–ü—Ä–æ–≥—Ä–µ—Å—Å: 0%</div>
                            </div>
                        </div>
                        <div class="file-input-group">
                            <label for="filePathInput">–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤:</label>
                            <input type="text" 
                                id="filePathInput" 
                                class="file-path-input"
                                placeholder="C:\logs\proxy.log –∏–ª–∏ /var/log/proxy.log"
                                value="D:/logs/access.log">
                            <button onclick="validateFilePath()" class="btn-secondary">
                                üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª
                            </button>
                        </div>
                            
                        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—É–±—Ä–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ –¢–µ–º–∞ –æ—Ç—Å—é–¥–∞) -->
                        <div class="parsing-buttons">
                            <button onclick="startParsing()" id="startParsingBtn" class="btn-primary" disabled>
                                üöÄ –ù–∞—á–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- –ë–ª–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π —Å –¥–∞–Ω–Ω—ã–º–∏ –ü–û–î header -->
        <div class="actions-panel">
            <div class="actions-header">
                <h4>üìä –î–µ–π—Å—Ç–≤–∏—è —Å –¥–∞–Ω–Ω—ã–º–∏</h4>
            </div>
            <div class="actions-buttons">
                <button onclick="exportData('csv')">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
                <button onclick="exportData('json')">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
                <button onclick="showTopUrls()">–¢–æ–ø 100 URL</button>
                <button onclick="showTopUsers()">–¢–æ–ø 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
            </div>
        </div>

        <div class="filters">
            <!-- –í–µ—Ä—Ö–Ω–∏–π —Ä—è–¥ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
            <div class="filter-group filter-1">
                <label for="dateFrom">–î–∞—Ç–∞ —Å:</label>
                <input type="datetime-local" id="dateFrom">
            </div>
            
            <div class="filter-group filter-2">
                <label for="dateTo">–î–∞—Ç–∞ –ø–æ:</label>
                <input type="datetime-local" id="dateTo">
            </div>
            
            <div class="filter-group filter-3">
                <label for="clientIp">IP –∫–ª–∏–µ–Ω—Ç–∞:</label>
                <input type="text" id="clientIp" placeholder="172.22.7.60">
            </div>
            
            <div class="filter-group filter-4">
                <label for="username">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</label>
                <input type="text" id="username" placeholder="user_u_u">
            </div>
            
            <div class="filter-group filter-5">
                <label for="status">–°—Ç–∞—Ç—É—Å:</label>
                <select id="status">
                    <option value="">–í—Å–µ</option>
                    <option value="200">200 OK</option>
                    <option value="403">403 Forbidden</option>
                    <option value="404">404 Not Found</option>
                    <option value="407">407 Proxy Auth Required</option>
                </select>
            </div>
            
            <div class="filter-group filter-6">
                <label for="action" >–î–µ–π—Å—Ç–≤–∏–µ:</label>
                <select id="action">
                    <option value=">–í—Å–µ</option>
                    <option value="TCP_DENIED">TCP_DENIED</option>
                    <option value="TCP_MISS">TCP_MISS</option>
                    <option value="TCP_HIT">TCP_HIT</option>
                    <option value="TCP_REFRESH">TCP_REFRESH</option>
                </select>
            </div>
            
            <div class="filter-group filter-search">
                <label for="search">–ü–æ–∏—Å–∫ –ø–æ URL:</label>
                <input type="text" id="search" placeholder="–í–≤–µ–¥–∏—Ç–µ —á–∞—Å—Ç—å URL">
            </div>
            
            <div class="filter-group filter-buttons">
                <label>&nbsp;</label>
                <div class="buttons-container">
                    <button class="btn-primary" onclick="loadData()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                    <button class="btn-secondary" onclick="clearFilters()">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="filter-group filter-status">
                <label>&nbsp;</label>
                <div class="request-status" id="requestStatus">
                    <span id="statusText">–ì–æ—Ç–æ–≤</span>
                    <button onclick="cancelCurrentRequest()" id="cancelRequestBtn" 
                            class="btn-cancel" style="display: none;">
                        ‚úï –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>

        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalRequests">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="errorRequests">0</div>
                <div class="stat-label">–û—à–∏–±–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgResponseTime">0</div>
                <div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è (–º—Å)</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="uniqueIps">0</div>
                <div class="stat-label">IP –∞–¥—Ä–µ—Å</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalTraffic">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ (–ú–ë)</div>
            </div>
        </div>

        <div class="charts">
            <div class="chart-container">
                <canvas id="statusChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="timeChart"></canvas>
            </div>
        </div>

        <div id="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        <div id="importProgress" class="progress-container">
            <div class="progress-bar">
                <div id="importBar" class="progress-fill"></div>
            </div>
            <div id="importInfo" class="progress-info">–ò–º–ø–æ—Ä—Ç: 0%</div>
        </div>
        
        <div id="loadingProgress" class="progress-container" style="display: none;">
            <div class="progress-bar">
                <div id="loadingProgressBar" class="progress-fill"></div>
            </div>
            <div id="loadingProgressText" class="progress-info">–ó–∞–≥—Ä—É–∑–∫–∞: 0%</div>
        </div>

        
        <table id="logsTable" class="logs-table">
            <thead>
                <tr>
                    <th data-sort="time">–í—Ä–µ–º—è ‚¨ç</th>
                    <th data-sort="ip">IP –∫–ª–∏–µ–Ω—Ç–∞</th>
                    <th data-sort="username">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                    <th data-sort="statusCode">–°—Ç–∞—Ç—É—Å</th>
                    <th data-sort="action">–î–µ–π—Å—Ç–≤–∏–µ</th>
                    <th data-sort="responseTime">–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞</th>
                    <th data-sort="responseSize">–†–∞–∑–º–µ—Ä</th>
                    <th>URL</th>
                    <th data-sort="domain">–î–æ–º–µ–Ω</th>
                </tr>
            </thead>
            <tbody id="logsBody"></tbody>
        </table>

        <div class="pagination" id="pagination">
            <button class="btn-secondary" onclick="changePage(-1)">‚Üê –ù–∞–∑–∞–¥</button>
            <span id="pageInfo">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1</span>
            <button class="btn-secondary" onclick="changePage(1)">–í–ø–µ—Ä–µ–¥ ‚Üí</button>
        </div>
    </div>
    <div id="topUrlsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üåê –¢–æ–ø 100 URL</h2>
                <span class="close-modal" onclick="closeModal('topUrlsModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="table-container">
                    <table id="topUrlsTable" class="top-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>URL</th>
                                <th>–î–æ–º–µ–Ω</th>
                                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤</th>
                            </tr>
                        </thead>
                        <tbody id="topUrlsBody">
                            <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button onclick="exportTopData('urls')" class="btn-secondary">
                        üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
                    </button>
                    <button onclick="closeModal('topUrlsModal')" class="btn-primary">
                        –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div id="topUsersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë§ –¢–æ–ø 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
                <span class="close-modal" onclick="closeModal('topUsersModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="table-container">
                    <table id="topUsersTable" class="top-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤</th>
                                <th>–ê–¥—Ä–µ—Å IP</th>
                                <th>–ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å</th>
                                <th>–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å</th>
                            </tr>
                        </thead>
                        <tbody id="topUsersBody">
                            <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button onclick="exportTopData('users')" class="btn-secondary">
                        üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
                    </button>
                    <button onclick="closeModal('topUsersModal')" class="btn-primary">
                        –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="app.js"></script>
</body>
</html>